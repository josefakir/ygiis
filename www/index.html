<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" href="css/template.css">
	<link rel="stylesheet" href="css/main.css">
	<script src="js/jquery-2.2.1.min.js"></script>
	<script src="js/main.js"></script>
</head>
<body>
<script>
  // This is called with the results from from FB.getLoginStatus().
  function statusChangeCallback(response) {
    if (response.status === 'connected') {
      // Logged into your app and Facebook.
      testAPI();
    } else if (response.status === 'not_authorized') {
      // The person is logged into Facebook, but not your app.
      document.getElementById('status').innerHTML = 'Please log ' +
        'into this app.';
    } else {
      // The person is not logged into Facebook, so we're not sure if
      // they are logged into this app or not.
      document.getElementById('status').innerHTML = 'Por favor inicia sesión en Facebook ';
    }
  }
  // This function is called when someone finishes with the Login
  // Button.  See the onlogin handler attached to it in the sample
  // code below.
  function checkLoginState() {
    FB.getLoginStatus(function(response) {
      statusChangeCallback(response);
    });
  }

  window.fbAsyncInit = function() {
  FB.init({
    appId      : '961323307299283',
    cookie     : true,  // enable cookies to allow the server to access 
                        // the session
    xfbml      : true,  // parse social plugins on this page
    version    : 'v2.5' // use graph api version 2.5
  });
  FB.getLoginStatus(function(response) {
    statusChangeCallback(response);
  });

  };

  // Load the SDK asynchronously
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));

  // Here we run a very simple test of the Graph API after login is
  // successful.  See statusChangeCallback() for when this call is made.
  function testAPI() {
    
    FB.api('/me', { locale: 'es_MX', fields: 'name, email' }, function(response) {
    	console.log('Welcome!  Fetching your information.... ');
    	//url = "http://ygiis.mx/api/?m=loginFacebook?u="+response.email;
    	$.ajax({
    		url : "http://ygiis.mx/api/?m=loginFacebook?u=asdf",
    		success : function(a){

    			console.log(a);
    		}
    	})
    	/*
        console.log(response.name);
        console.log(response.email);
        console.log(response.id);
    	*/
    });
  }
</script>
	<div id="plecas"></div>
	<div class="container">
		<div class="three column">&nbsp;</div>
		<div class="six column">
			<img src="images/logo.png" alt="Logo" class="w100">
			<div id="login" class="w100">
				<p>&nbsp;</p>
				<p>&nbsp;</p>
				<form action="">
					<p class="w80 acidregular white">Usuario</p>
					<input type="text" class="input_login" name="usuario" id="usuario">
					<p class="w80 acidregular white">Contrasena:</p>
					<input type="password" class="input_login" name="pass" id="pass">
					<p>&nbsp;</p>
					<p class="tac"><a id="iniciarsesion" href="#"><img src="images/login.jpg" alt=""></a></p>
				</form>
				<p>&nbsp;</p>
				<a href="#" onclick="FB.logout();" style="text-align: center;">cerrar</a>
				<fb:login-button scope="public_profile,email" onlogin="checkLoginState();" style="    display: block;
    margin: 0 auto;
    width: 70px;
"></fb:login-button>
    			<p id="status"></p>
			</div>
			<p>&nbsp;</p>
			
			<!--<a href="home.html">
				<img class="w100" src="images/fb.jpg" alt="">
			</a>-->
		</div>
		<div class="three column">&nbsp;</div>
	</div>
	<script>
	$(document).ready(function(){
		/* sesion */
		if(localStorage.getItem("userid")>0){
			window.location="home.html";
		};
		/* fin sesion */
		back = 1;
		window.setInterval(function(){
			var image = $('body');
			image.css("background-image", "url('images/b"+back+".jpg')");
			
			if(back==3){
				back=1;
			}else{
				back++;
			}
		}, 5000);
		$('#iniciarsesion').click(function(e){
			e.preventDefault();
			url = "http://ygiis.mx/index.php/rest/post/user/login?username="+$('#usuario').val()+"&password="+$('#pass').val();
			$.ajax({
				url : url,
				success : function(data){
					console.log(data)
					if(data.userid>0){
						localStorage.setItem('userid', data.userid);
						localStorage.setItem('username', data.username);
						localStorage.setItem('session_id', data.session_id);
						$('#loading').fadeOut('fast');
						window.location = "home.html";
					}else{
						$('#loading').fadeOut('fast');
						//alert('Credenciales inválidas')
						alert(data.error_description)
					}
				},
				beforeSend : function(){
					$('#loading').fadeIn('fast');
				}
			})

		});
	});
	</script>
	<div id="loading">
		<img src="images/loading.gif" alt="">
	</div>
</body>
</html>